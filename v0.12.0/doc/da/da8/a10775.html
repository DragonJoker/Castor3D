<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Castor3D: Render explanations</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../Castor3D.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../castor-small.png"/></td>
  <td id="projectalign">
   <div id="projectname">Castor3D<span id="projectnumber">&#160;0.12.0</span>
   </div>
   <div id="projectbrief">Multiplatform 3D engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Render explanations </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md218"></a>
General</h1>
<p >The rendering in Castor3D is splitted in several passes:</p><ul>
<li>Environment passes</li>
<li>Shadow passes</li>
<li>Deferred rendering for opaque objects</li>
<li>Background pass</li>
<li>Weighted Blended rendering for transparent objects</li>
</ul>
<div class="image">
<img src="../../render.png" alt=""/>
<div class="caption">
render</div></div>
   <h1><a class="anchor" id="autotoc_md219"></a>
Environment pass</h1>
<p >This pass generates the environment map for one node that needs it.</p>
<p >Note that multiple nodes can need a different environment map, thus trigger multiple environment passes.</p>
<p >It is splitted in 3 specific passes:</p><ul>
<li>Opaque pass (using forward rendering)</li>
<li>Background pass</li>
<li>Transparent pass (using forward rendering)</li>
</ul>
<p >Its result is stored into a cube map.</p>
<div class="image">
<img src="../../environment_pass.png" alt=""/>
<div class="caption">
environment_pass</div></div>
   <h1><a class="anchor" id="autotoc_md220"></a>
Shadow pass</h1>
<p >This pass generates shadow map for one light source.</p>
<p >The engine currently supports three light source type, with their specific shadow passes:</p><ul>
<li>Directional: This pass generates cascaded shadow maps (with a maximum of 4 cascades)</li>
<li>Point: This pass renders to a cube map, and is actually splitted in 6 passes (one per cube face)</li>
<li>Spot: This pass renders to a single 2D texture</li>
</ul>
<p >That being said, it is also important to note that point and spot shadow maps are stored in texture arrays (Cube an 2D, respectively).</p>
<p >The cascades of the directional shadow map are also stored in a 2D texture array.</p>
<p >It allows to limit the number of texture bindings, especially for passes using forward rendering.</p>
<p >Since Castor3D allows the user to choose the shadows type he wants (Raw, PCF or VSM), the results are always stored in textures using the R32G32_SFLOAT pixel format.</p>
<div class="image">
<img src="../../shadow_pass.png" alt=""/>
<div class="caption">
shadow_pass</div></div>
   <h1><a class="anchor" id="autotoc_md221"></a>
Deferred rendering</h1>
<p >This pass is the most complex one, it contains multiple subpasses:</p><ul>
<li>Opaque pass</li>
<li>SSAO pass</li>
<li>Subsurface Scattering pass</li>
<li>Lighting pass</li>
<li>Reflection pass</li>
</ul>
<div class="image">
<img src="../../deferred_rendering.png" alt=""/>
<div class="caption">
deferred_rendering</div></div>
   <h2><a class="anchor" id="autotoc_md222"></a>
Opaque pass</h2>
<p >This pass is the geometry pass, generating the buffers needed for the other subpasses.</p>
<p >Castor3D uses currently 5 (+1) buffers:</p><ul>
<li>**&gt;Depth buffer** Uses D24_UNORM_S8_UINT pixel format.</li>
<li><b>Data 1 buffer</b> Uses R32G32B32A32_SFLOAT pixel format. The RGB channels store the world space normal. The A channel stores object material flags.</li>
<li><b>Data 2 buffer</b> Uses R16G16B16A16_SFLOAT pixel format. The RGB channels store the diffuse/albedo colour. The A channel is used to store:<ul>
<li>Shininess in Phong</li>
<li>Glossiness in PBR Specular/Glossiness</li>
<li>Unused in PBR Metallic/Roughness</li>
</ul>
</li>
<li><b>Data 3 buffer</b> Uses R16G16B16A16_SFLOAT pixel format The RGB channels store the specular colour, in pipelines that need it. For PBR Metallic/Roughness, R stores the Metallic value, G stores the Roughness value, B is unused. The A channel stores the Ambient Occlusion value.</li>
<li><b>Data 4 buffer</b> Uses R16G16B16A16_SFLOAT pixel format The RGB channels store the emissive colour. The A channel stores the transmittance value.</li>
<li><b>Data 5 buffer</b> Uses R16G16B16A16_SFLOAT pixel format The RG channels store the velocity value (computed with previous frame). The B channel stores the material index. The A channel is unused.</li>
</ul>
<h2><a class="anchor" id="autotoc_md223"></a>
SSAO pass</h2>
<p >This pass implements the Scalable Ambient Obscurance algorithm described here: <a href="https://research.nvidia.com/sites/default/files/pubs/2012-06_Scalable-Ambient-Obscurance/McGuire12SAO.pdf">https://research.nvidia.com/sites/default/files/pubs/2012-06_Scalable-Ambient-Obscurance/McGuire12SAO.pdf</a></p>
<p >It is thus splitted in three subpasses:</p><ul>
<li>Linearise depth pass</li>
<li>Raw SSAO pass</li>
<li>Blur pass</li>
</ul>
<h2><a class="anchor" id="autotoc_md224"></a>
Lighting pass</h2>
<p >This pass is actually a group of lighting subpasses, one subpass per light source.</p>
<p >If the light source generates shadows, its shadow map will be used, to produce shadows of the type chosen by the user.</p>
<p >The point and spot light passes first run a stencil pass, to reduce their effect area.</p>
<h2><a class="anchor" id="autotoc_md225"></a>
Subsurface Scattering pass</h2>
<p >This pass implements the Screen-Space Subsurface Scattering algorithm described here : <a href="http://www.iryoku.com/sssss/">http://www.iryoku.com/sssss/</a></p>
<p >It is thus splitted in four passes:</p><ul>
<li>Three successive blur passes</li>
<li>A combination pass</li>
</ul>
<h2><a class="anchor" id="autotoc_md226"></a>
Reflection pass</h2>
<p >This pass combines the results of all the previous passes:</p><ul>
<li>It applies the ambient factor with provided ambient occlusion.</li>
<li>It applies the diffuse and specular results from lighting pass.</li>
<li>It also applies reflection and/or refraction, using the skybox or the provided environment maps.</li>
<li>For PBR pipelines, it also applies the IBL, if no reflection is asked on the processed fragment.</li>
<li>If the scene needs some fog, it is applied here.</li>
</ul>
<h1><a class="anchor" id="autotoc_md227"></a>
Background pass</h1>
<p >This pass is the most simple one, it just draws the scene's skybox.</p>
<p >It is performed after the opaque objects pass to have the benefits of a depth test, after the depth buffer is filled by the opaque pass.</p>
<h1><a class="anchor" id="autotoc_md228"></a>
Weighted Blended rendering</h1>
<p >This pass implements the blended weighted rendering described here: <a href="http://jcgt.org/published/0002/02/09/paper.pdf">http://jcgt.org/published/0002/02/09/paper.pdf</a></p>
<p >It is thus splitted in two passes:</p><ul>
<li>Accumulation pass</li>
<li>Resolve pass</li>
</ul>
<div class="image">
<img src="../../weighted_blended_rendering.png" alt=""/>
<div class="caption">
weighted_blended_rendering</div></div>
    </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 18 2022 21:28:50 for Castor3D by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>

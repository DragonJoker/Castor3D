vcpkg_check_linkage(ONLY_DYNAMIC_LIBRARY)

vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO DragonJoker/Castor3D
    REF b5cb00ae0f85206ac29fabce9162c206f67fe370
    HEAD_REF master
    SHA512 a67192a6f465ab2b18b3748d36371a708268f66d051c973c18886dec25294afc21cb47dae249299950d6c5e36b43a2c82337da260ec6007641452d00f0b079e2
)

vcpkg_from_github(OUT_SOURCE_PATH CMAKE_SOURCE_PATH
    REPO DragonJoker/CMakeUtils
    REF ad28a43953f8a65b3f95b40824ac43c7278a565c
    HEAD_REF master
    SHA512 224d645f0bd7d8e1d845e894f09125fb60e29b0b19c2280142751ba8aa8f6d8d29fac5758fe22f21664276e4079066f40a3c2de21f555f2da57264fc38652787
)

file(REMOVE_RECURSE "${SOURCE_PATH}/CMake")
file(COPY "${CMAKE_SOURCE_PATH}/" DESTINATION "${SOURCE_PATH}/CMake")

if ("assimp" IN_LIST FEATURES)
    set(BUILD_IMPORTER_ASSIMP ON)
else()
    set(BUILD_IMPORTER_ASSIMP OFF)
endif()

if ("freeimage" IN_LIST FEATURES)
    set(USE_FREEIMAGE ON)
else()
    set(USE_FREEIMAGE OFF)
endif()

if ("glsl" IN_LIST FEATURES)
    set(USE_GLSL ON)
else()
    set(USE_GLSL OFF)
endif()

if ("vkfft" IN_LIST FEATURES)
    set(USE_VKFFT ON)
else()
    set(USE_VKFFT OFF)
endif()

vcpkg_cmake_configure(
    SOURCE_PATH ${SOURCE_PATH}
    OPTIONS
        -DCASTOR_BUILD_PLUGINS=ON
        -DCASTOR_BUILDGRP_DEMO=OFF
        -DCASTOR_BUILDGRP_INTEROP=OFF
        -DCASTOR_BUILDGRP_TEST=OFF
        -DCASTOR_BUILDGRP_TOOL=OFF
        -DCASTOR_DISABLE_DELAYED_INITIALISATION=ON
        -DCASTOR_FORCE_VCPKG_SUBMODULES=ON
        -DCASTOR_USE_GLSLANG=ON
        -DCASTOR_USE_MESH_SHADERS=OFF
        -DCASTOR_USE_TASK_SHADERS=OFF
        -DPROJECTS_UNITY_BUILD=ON
        -DPROJECTS_USE_PRECOMPILED_HEADERS=OFF
        -DVCPKG_BUILD=ON
        -DCASTOR_FORCE_VCPKG_SUBMODULES=ON
        -DCASTOR_BUILD_IMPORTER_ASSIMP=${BUILD_IMPORTER_ASSIMP}
        -DCASTOR_C3D_NEEDS_GLSL=${USE_GLSL}
        -DCASTOR_USE_FREEIMAGE=${USE_FREEIMAGE}
)

vcpkg_copy_pdbs()
vcpkg_cmake_install()
vcpkg_cmake_config_fixup(CONFIG_PATH lib/cmake/Castor3D)

file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/include")
file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/share")
file(INSTALL ${SOURCE_PATH}/LICENSE DESTINATION ${CURRENT_PACKAGES_DIR}/share/${PORT} RENAME copyright)